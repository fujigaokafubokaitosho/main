<!DOCTYPE html>
<html>
<head>
<base target="_top">
  <meta charset="UTF-8">
  <meta http-equiv="Permissions-Policy" content="camera=(self 'https://script.google.com')">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <script src="https://unpkg.com/html5-qrcode"></script>

  <link rel="stylesheet" href="stylesheet_common.css">
  <link rel="stylesheet" href="stylesheet_android.css">
  <link rel="stylesheet" href="stylesheet_ios.css">
  <style>
    /* CSS„ÅØÁúÅÁï•„Åõ„Åö„Åù„ÅÆ„Åæ„ÅæË≤º„Çä‰ªò„Åë„Å¶„Åè„Å†„Åï„ÅÑ */
    :root { --primary: #2563eb; --primary-light: #dbeafe; --bg: #f8fafc; --text: #1e293b; --danger: #ef4444; --success: #10b981; }
    html { height: 100%; }
    body { font-family: 'Helvetica Neue', Arial, sans-serif; background: var(--bg); color: var(--text); padding-bottom: 80px; -webkit-tap-highlight-color: transparent; margin: 0; }
    body:not(.pc) { height: 100%; overflow: hidden; }
    header { background: #fff; padding: 16px; border-bottom: 1px solid #e2e8f0; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 100; }
    .container { padding: 16px; max-width: 500px; margin: 0 auto; height: calc(100% - 70px); overflow-y: auto; }
    .card { background: #fff; border-radius: 16px; padding: 16px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); margin-bottom: 16px; }
    #loginSection { position: fixed; top: 0; left: 0; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, #60a5fa 0%, #2563eb 100%); z-index: 5000; }
    .login-card { width: 85%; max-width: 350px; background: #fff; padding: 32px; border-radius: 24px; box-shadow: 0 10px 25px rgba(0,0,0,0.2); }
    .login-input { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #e2e8f0; border-radius: 8px; box-sizing: border-box; font-size: 16px; }
    .login-btn { width: 100%; padding: 14px; background: var(--primary); color: #fff; border: none; border-radius: 8px; font-weight: bold; margin-top: 16px; cursor: pointer; }
    .nav-bar { position: fixed; bottom: 0; width: 100%; background: #fff; display: flex; border-top: 1px solid #e2e8f0; padding: 8px 0; z-index: 1000; }
    .nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; color: #94a3b8; cursor: pointer; border: none; background: none; }
    .nav-item.active { color: var(--primary); }
    .nav-item .material-icons { font-size: 24px; margin-bottom: 4px; }
    .nav-item span { font-size: 10px; font-weight: bold; }
    .search-box { position: relative; margin-bottom: 16px; }
    .search-box input { width: 100%; padding: 12px 12px 12px 40px; border: 1px solid #e2e8f0; border-radius: 12px; box-sizing: border-box; font-size: 14px; }
    .search-box .material-icons { position: absolute; left: 12px; top: 11px; color: #94a3b8; }
    .col-date { font-size: 0.85rem !important; color: #64748b; white-space: nowrap; display: flex; align-items: center; margin-left: 8px; min-width: 65px; justify-content: flex-end;}
    .list-row, .book-item { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid #f1f5f9; min-height: 64px;}
    .modal-overlay { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); display:flex; align-items:center; justify-content:center; z-index:9999; }
    .modal-content { background:white; padding:20px; border-radius:12px; width:85%; max-width:350px; box-shadow:0 10px 25px rgba(0,0,0,0.1); }
    .modal-content h3 { margin: 0 0 12px; font-size: 18px; color: #1e293b; }
    .modal-content p { font-size: 14px; color: #64748b; margin-bottom: 20px; line-height: 1.5; }
    #modalEmailInput { width: 100%; padding: 12px; border: 1px solid #e2e8f0; border-radius: 8px; margin-bottom: 20px; box-sizing: border-box; }
    .modal-btns { display: flex; gap: 10px; justify-content: center; }
    .btn-primary { background: #2563eb; color: white; border: none; padding: 10px 20px; border-radius: 8px; font-weight: bold; cursor: pointer; flex: 1; }
    .btn-secondary { background: #f1f5f9; color: #475569; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; flex: 1; }
    #toast { position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%); padding: 12px 16px; border-radius: 12px; color: #fff; font-size: 14px; opacity: 0; transition: opacity 0.3s ease; z-index: 7000; width: calc(100% - 40px); max-width: 320px; box-sizing: border-box; text-align: center; pointer-events: none; }
    #loading { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.8); display: none; align-items: center; justify-content: center; z-index: 6000; }
    .spinner { width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid var(--primary); border-radius: 50%; animation: spin 1s linear infinite; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    .switch { position: relative; display: inline-block; width: 40px; height: 22px; }
    .switch input { opacity: 0; width: 0; height: 0; }
    .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #e2e8f0; transition: .3s; border-radius: 22px; }
    .slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 3px; bottom: 3px; background-color: white; transition: .3s; border-radius: 50%; box-shadow: 0 1px 3px rgba(0,0,0,0.2); }
    input:checked + .slider { background-color: var(--primary); }
    input:checked + .slider:before { transform: translateX(18px); }
    .col-title { font-weight: 500; font-size: 14px; flex: 1; }
    .badge { position: absolute; top: -8px; right: -8px; background: var(--danger); color: #fff; font-size: 10px; width: 18px; height: 18px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; border: 2px solid #fff; z-index: 10; }
    .badge-mine { background:#dcfce7; color:#166534; font-size:11px; padding:2px 6px; border-radius:4px; font-weight:bold; margin-top:4px; width:fit-content; }
    .badge-others { background:#fee2e2; color:#ef4444; font-size:11px; padding:2px 6px; border-radius:4px; font-weight:bold; margin-top:4px; width:fit-content; }
    .accordion-header { display: flex; justify-content: space-between; align-items: center; padding: 12px; background: #f8fafc; border-radius: 8px; cursor: pointer; margin-top: 8px; }
    .accordion-content { display: none; padding: 0 12px; }
    .accordion-content.active { display: block; }
    #adminQrContainer { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 2000; display: none; }
    #adminQrReader { width: 100% !important; height: 100% !important; }
    .qr-guide-overlay { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 250px; height: 250px; border: 2px solid var(--primary); border-radius: 20px; box-shadow: 0 0 0 4000px rgba(0,0,0,0.6); pointer-events: none; z-index: 2001; }
    #imagePreviewOverlay { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:9000; align-items:center; justify-content:center; }
    #imagePreviewOverlay.preview-loading::after { content: ""; position: absolute; width: 40px; height: 40px; border: 4px solid rgba(255,255,255,0.2); border-top: 4px solid #fff; border-radius: 50%; animation: spin 1s linear infinite; z-index: 9001; }
    #previewImage { position: relative; z-index: 9002; max-width: 95%; max-height: 90%; object-fit: contain; opacity: 0; transition:opacity 0.3s; }
  </style>
</head>
<body>

<div id="loading">
  <div style="text-align: center;">
    <div class="spinner" style="margin: 0 auto 16px;"></div>
    <div id="loadingText" style="color: var(--primary); font-weight: bold; font-size: 16px;"></div>
    <div id="loadingSubText" style="color: #64748b; font-size: 12px; margin-top: 4px;"></div>
  </div>
</div>

<div id="toast"></div>

<div id="loginSection">
  <div class="login-card">
    <h2 style="margin:0 0 24px 0; text-align:center; color:var(--primary);">Âõ≥Êõ∏ÁÆ°ÁêÜ„Ç¢„Éó„É™</h2>
    <input type="email" id="email" class="login-input" placeholder="„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ">
    <input type="password" id="pass" class="login-input" placeholder="„Éë„Çπ„ÉØ„Éº„Éâ">
    <button class="login-btn" onclick="login()">„É≠„Ç∞„Ç§„É≥</button>
    <p style="margin-top: 20px;">
    <a href="#" onclick="goToSignup(); return false;">ÂàùÂõûÁôªÈå≤„ÅØ„Åì„Å°„Çâ</a>
  „ÄÄ</p>
    <div style="margin-top: 20px; text-align: center;">
      <a href="javascript:void(0)" onclick="openResetModal()" style="font-size: 12px; color: #64748b; text-decoration: underline;">„Éë„Çπ„ÉØ„Éº„Éâ„ÇíÂøò„Çå„ÅüÂ†¥Âêà„ÅØ„Åì„Å°„Çâ</a>
    </div>
  </div>
</div>

<div id="mainSection" style="display:none;">
  <header>
    <div style="display:flex; align-items:center; gap:8px;">
      <div style="background:var(--primary-light); color:var(--primary); padding:8px; border-radius:10px;"><span class="material-icons">account_circle</span></div>
      <div>
        <div style="font-size:10px; color:#64748b;">„É≠„Ç∞„Ç§„É≥‰∏≠</div>
        <div id="userDisp" style="font-size:14px; font-weight:bold;">„É¶„Éº„Ç∂„ÉºÂêç</div>
      </div>
    </div>
    <button onclick="logout()" style="background:none; border:none; color:#94a3b8;"><span class="material-icons">logout</span></button>
  </header>

  <div class="container">
    <div id="tab0" class="tab-content">
      <div class="card" id="myStatusArea">
        <h3 style="margin:0 0 12px 0; font-size:16px; display:flex; align-items:center; gap:8px;"><span class="material-icons" style="color:var(--primary);">bookmark</span>„ÅÇ„Å™„Åü„ÅåÂÄü„Çä„Å¶„ÅÑ„ÇãÊú¨</h3>
        <div id="myLoanList"></div>
      </div>
      
      <div id="scanBtnArea" style="display:none; margin-bottom:16px;">
        <button onclick="startBookScan()" style="width:100%; padding:20px; background:#fff; border:2px dashed var(--primary); border-radius:16px; color:var(--primary); font-weight:bold; display:flex; flex-direction:column; align-items:center; gap:8px;">
          <span class="material-icons" style="font-size:32px;">qr_code_scanner</span>Êú¨„Çí„Çπ„Ç≠„É£„É≥„Åô„Çã
        </button>
      </div>
      
      <div id="bookReaderContainer" style="display:none; position:relative; overflow:hidden; border-radius:16px; margin-bottom:16px;">
        <div id="bookReader" style="width:100%;"allow="camera"></div>
        <button onclick="stopBookScan()" style="position:absolute; bottom:10px; right:10px; background:rgba(0,0,0,0.5); color:#fff; border:none; padding:8px 16px; border-radius:20px;">Èñâ„Åò„Çã</button>
      </div>

      <div class="card">
        <h3 id="cartTitleArea" style="margin:0 0 12px 0; font-size:16px; display:flex; align-items:center; gap:8px;">
          <span class="material-icons" style="color:var(--success);">shopping_cart</span>ÈÅ∏Êäû‰∏≠„ÅÆÊú¨ (<span id="cartCountLabel">0</span>)
        </h3>
        <div id="cartArea"></div>
        <div id="submitButtonsArea" style="margin-top:20px; display:flex; gap:10px;">
          <button onclick="triggerAdminScan()" style="flex:2; padding:14px; background:var(--primary); color:#fff; border:none; border-radius:12px; font-weight:bold; display:flex; align-items:center; justify-content:center; gap:8px;"><span class="material-icons">qr_code_2</span> Á¢∫ÂÆö„Åô„Çã</button>
          <button onclick="cart=[];updateCartUI();" style="flex:1; padding:14px; background:#f1f5f9; color:#64748b; border:none; border-radius:12px; font-weight:bold;">Ê∂àÂéª</button>
        </div>
      </div>
    </div>

    <div id="tab1" class="tab-content" style="display:none;">
      <div class="card">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px;">
          <h3 style="margin:0; font-size:16px; display:flex; align-items:center; gap:8px;">
            <span class="material-icons" style="color:var(--primary);">library_books</span>ËîµÊõ∏„Åã„ÇâË≤∏Âá∫
          </h3>
          <div style="display:flex; align-items:center; gap:8px;">
            <span style="font-size:11px; font-weight:bold; color:#64748b;">ÂÖ®Ë°®Á§∫</span>
            <label class="switch">
              <input type="checkbox" id="showAllToggle" onchange="handleToggleAll(this.checked)">
              <span class="slider"></span>
            </label>
          </div>
        </div>
        <div class="search-box">
          <span class="material-icons">search</span>
          <input type="text" id="searchInput" placeholder="„Çø„Ç§„Éà„É´„ÅßÊ§úÁ¥¢..." oninput="handleSearchInput()">
        </div>
        <div id="listSearch"></div>
      </div>

      <div class="card">
        <h3 style="margin:0 0 8px 0; font-size:16px;">Áä∂Ê≥ÅÂà•„É™„Çπ„Éà</h3>
        <div class="accordion-header" onclick="toggleAccordion('rented')">
          <span style="font-size:14px; font-weight:bold;">ÁèæÂú®Ë≤∏Âá∫‰∏≠„ÅÆÊú¨‰∏ÄË¶ß</span>
          <span id="icon-rented" class="material-icons">expand_more</span>
        </div>
        <div id="content-rented" class="accordion-content"></div>
        
        <div class="accordion-header" onclick="toggleAccordion('returned')">
          <span style="font-size:14px; font-weight:bold;">ÊúÄËøëËøîÂç¥„ÅÆ„ÅÇ„Å£„ÅüÊú¨‰∏ÄË¶ß</span>
          <span id="icon-returned" class="material-icons">expand_more</span>
        </div>
        <div id="content-returned" class="accordion-content"></div>
      </div>
    </div>
  </div>

  <nav class="nav-bar">
    <button class="nav-item active" onclick="switchTab(0)">
      <div style="position:relative;">
        <span class="material-icons">person</span>
        <div id="cartCountBadge" class="badge" style="display:none;">0</div>
      </div>
      <span>„Éû„Ç§„Éö„Éº„Ç∏</span>
    </button>
    <button class="nav-item" onclick="switchTab(1)">
      <span class="material-icons">search</span>
      <span>ËîµÊõ∏Ê§úÁ¥¢</span>
    </button>
  </nav>
</div>

<div id="adminQrContainer">
  <div class="qr-guide-overlay"></div>
  <div id="adminQrReader"></div>
  <button onclick="stopAdminScan()" style="position:absolute; bottom:40px; left:50%; transform:translateX(-50%); background:#fff; color:#000; border:none; padding:12px 32px; border-radius:30px; font-weight:bold; z-index:2002;">„Ç≠„É£„É≥„Çª„É´</button>
</div>

<div id="imagePreviewOverlay" onclick="closePreview()">
  <img id="previewImage" src="">
  <div style="position:absolute; top:20px; right:20px; color:white;"><span class="material-icons">close</span></div>
</div>

<div id="customModalOverlay" class="modal-overlay" style="display:none;">
  <div class="modal-content">
    <h3 id="modalTitle" style="margin-top:0;">üîë „Çø„Ç§„Éà„É´</h3>
    <p id="modalMessage" style="font-size:13px; color:#64748b; white-space: pre-wrap;"></p>
    <div id="modalInputArea" style="display:none;">
      <input type="email" id="modalEmailInput" placeholder="example@mail.com" style="width:100%; padding:10px; margin:15px 0; border:1px solid #ddd; border-radius:6px; box-sizing:border-box;">
    </div>
    <div class="modal-btns">
      <button id="modalCancelBtn" onclick="closeCustomModal()" class="btn-secondary">„Ç≠„É£„É≥„Çª„É´</button>
      <button id="modalOkBtn" class="btn-primary">OK</button>
    </div>
  </div>
</div>

<script src="./config_javascript.js"></script>
<script src="./javascript.js"></script>
</body>

</html>





